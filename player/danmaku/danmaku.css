
.danmaku-header{background:linear-gradient(180deg,var(--panel),color-mix(in srgb, var(--accent) 18%, var(--panel)));padding:6px 10px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-weight:700;font-size:12px;user-select:none;border-bottom:1px solid rgba(0,0,0,0.06)}
.danmaku-header:hover{background:linear-gradient(180deg,color-mix(in srgb, var(--accent) 22%, var(--panel)),color-mix(in srgb, var(--accent) 35%, var(--panel)))}
.danmaku-content{padding:8px;background:var(--panel);display:block}
.danmaku-content.collapsed{display:none}

.danmaku-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
  z-index: 10;
  
  --danmaku-scale: 1;
  --base-size: 24px;
}

.danmaku-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.danmaku-item {
  position: absolute;
  white-space: nowrap;
  font-family: "Segoe UI", "Microsoft YaHei", "SimHei", sans-serif; 
  font-weight: bold;
  text-shadow: 
    1px 0 0 #000, 0 1px 0 #000, 
    -1px 0 0 #000, 0 -1px 0 #000, 
    1px 1px 2px rgba(0,0,0,0.5);
  pointer-events: none;
  user-select: none;
  line-height: 1.1;
  will-change: transform, left, top;
  
  font-size: calc(var(--base-size) * var(--danmaku-scale));
  
  top: 0; 
}

.danmaku-overlay.small-scale .danmaku-item {
  text-shadow: 
    0.5px 0 0 #000, 0 0.5px 0 #000, 
    -0.5px 0 0 #000, 0 -0.5px 0 #000;
  font-weight: 600; 
}

#danmakuOverlay,
#fullscreen-danmaku-overlay { transition: opacity 0.2s ease; }
#danmakuOverlay.hidden,
#fullscreen-danmaku-overlay.hidden { opacity: 0; pointer-events: none; }

.danmaku-small { --base-size: 18px; }
.danmaku-normal { --base-size: 25px; }
.danmaku-big { --base-size: 36px; }


.danmaku-item.danmaku-small { margin-bottom: 2px; }
.danmaku-item.danmaku-normal { margin-bottom: 3px; }
.danmaku-item.danmaku-big { margin-bottom: 4px; }


.danmaku-item {
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.danmaku-item[data-position="top"],
.danmaku-item[data-position="bottom"] {
  max-width: 90%;
  text-align: center;
  box-sizing: border-box;
  word-wrap: break-word;
  hyphens: auto;
}

.danmaku-item[data-position="top"][style*="text-overflow"],
.danmaku-item[data-position="bottom"][style*="text-overflow"] {
  white-space: nowrap;
  display: block;
  text-align: center;
}

.danmaku-item[data-position="scroll"] {
  white-space: nowrap;
  overflow: visible;
}

.video-container.fullscreen .danmaku-small,
#fullscreen-danmaku-overlay.fullscreen .danmaku-small { font-size: 32px !important; }
.video-container.fullscreen .danmaku-normal,
#fullscreen-danmaku-overlay.fullscreen .danmaku-normal { font-size: 40px !important; }
.video-container.fullscreen .danmaku-big,
#fullscreen-danmaku-overlay.fullscreen .danmaku-big { font-size: 48px !important; }

.video-container.fullscreen .danmaku-item[data-position="top"],
.video-container.fullscreen .danmaku-item[data-position="bottom"],
#fullscreen-danmaku-overlay.fullscreen .danmaku-item[data-position="top"],
#fullscreen-danmaku-overlay.fullscreen .danmaku-item[data-position="bottom"] {
  max-width: 85% !important;
}

body.cinema-mode:not(.fullscreen) .danmaku-small,
#fullscreen-danmaku-overlay.cinema-mode:not(.fullscreen) .danmaku-small { font-size: 32px !important; }
body.cinema-mode:not(.fullscreen) .danmaku-normal,
#fullscreen-danmaku-overlay.cinema-mode:not(.fullscreen) .danmaku-normal { font-size: 40px !important; }
body.cinema-mode:not(.fullscreen) .danmaku-big,
#fullscreen-danmaku-overlay.cinema-mode:not(.fullscreen) .danmaku-big { font-size: 52px !important; }

.video-container.fullscreen .danmaku-item,
#fullscreen-danmaku-overlay.fullscreen .danmaku-item {
  transition: font-size 0.3s ease;
}

body.cinema-mode .danmaku-item,
#fullscreen-danmaku-overlay.cinema-mode .danmaku-item {
  transition: font-size 0.3s ease;
}

.danmaku-item.danmaku-small { font-size: 28px; }
.danmaku-item.danmaku-normal { font-size: 36px; }
.danmaku-item.danmaku-big { font-size: 48px; }

#fullscreen-danmaku-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: visible;
  z-index: 9999;
  box-sizing: border-box;
}

.video-container.fullscreen #fullscreen-danmaku-overlay,
body.cinema-mode #fullscreen-danmaku-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
  box-sizing: border-box;
  overflow: visible;
}

#fullscreen-danmaku-overlay .danmaku-item,
#danmakuOverlay .danmaku-item {
  position: absolute;
  will-change: transform;
}

.video-container.fullscreen #fullscreen-danmaku-overlay .danmaku-item {
  z-index: 9999;
}

.video-container.fullscreen #fullscreen-danmaku-overlay .danmaku-item[data-position="bottom"] {
  bottom: calc(var(--track-offset, 5px) + 100px) !important;
}

body.cinema-mode #fullscreen-danmaku-overlay .danmaku-item[data-position="bottom"] {
  bottom: calc(var(--track-offset, 5px) + 80px) !important;
}


.danmaku-form{margin-top:8px;padding:0;border-radius:6px;overflow:hidden;border:1px solid rgba(0,0,0,0.06);background:#fff}
.danmaku-input{display:flex;gap:6px;align-items:center;margin-bottom:6px}
.danmaku-input input{flex:1;padding:4px;border:1px solid #ccc;border-radius:4px;font-size:12px;background:#fff;color:#111}
.danmaku-input input::placeholder{color:#999}
.danmaku-controls{display:flex;gap:6px;align-items:center;font-size:11px}
.danmaku-controls select,.danmaku-controls button{padding:3px 6px;font-size:11px;border-radius:4px;border:1px solid #ccc;background:#fff;color:#111}
.danmaku-toggle{position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.7);color:#fff;border:none;padding:6px 10px;border-radius:4px;font-size:11px;z-index:20;cursor:pointer}
.fullscreen .danmaku-small { font-size: 32px; }
.fullscreen .danmaku-normal { font-size: 40px; }
.fullscreen .danmaku-big { font-size: 48px; }

#fullscreen-danmaku-overlay.fullscreen .danmaku-small { font-size: 32px; }
#fullscreen-danmaku-overlay.fullscreen .danmaku-normal { font-size: 40px; }
#fullscreen-danmaku-overlay.fullscreen .danmaku-big { font-size: 48px; }

body.theme-win95 .danmaku-header { 
  border-radius: 0 !important;
  background: #c0c0c0 !important;
  border: 2px outset #c0c0c0 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
  padding: 2px 6px !important;
}
body.theme-win95 .danmaku-form { 
  border-radius: 0 !important;
  background: #c0c0c0 !important;
  border: 2px outset #c0c0c0 !important;
  padding: 4px !important;
}
body.theme-win95 .danmaku-input input { 
  border-radius: 0 !important;
  background: #ffffff !important;
  border: 2px inset #c0c0c0 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
  padding: 2px 4px !important;
}
body.theme-win95 .danmaku-controls select { 
  border-radius: 0 !important;
  background: #ffffff !important;
  border: 2px inset #c0c0c0 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
  padding: 2px 4px !important;
}
body.theme-win95 .danmaku-controls button { 
  border-radius: 0 !important;
  background: #c0c0c0 !important;
  border: 2px outset #c0c0c0 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
  padding: 2px 6px !important;
}
body.theme-win95 .danmaku-controls button:hover {
  background: #c0c0c0 !important;
  border: 2px inset #c0c0c0 !important;
}
body.theme-win95 .danmaku-toggle { 
  border-radius: 0 !important;
  background: #c0c0c0 !important;
  border: 2px outset #c0c0c0 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
}

body.theme-win95pink .danmaku-header { 
  border-radius: 0 !important;
  background: #FFE3F1 !important;
  border: 2px outset #FFE3F1 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
  padding: 2px 6px !important;
}
body.theme-win95pink .danmaku-form { 
  border-radius: 0 !important;
  background: #FFE3F1 !important;
  border: 2px outset #FFE3F1 !important;
  padding: 4px !important;
}
body.theme-win95pink .danmaku-input input { 
  border-radius: 0 !important;
  background: #ffffff !important;
  border: 2px inset #FFE3F1 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
  padding: 2px 4px !important;
}
body.theme-win95pink .danmaku-controls select { 
  border-radius: 0 !important;
  background: #ffffff !important;
  border: 2px inset #FFE3F1 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
  padding: 2px 4px !important;
}
body.theme-win95pink .danmaku-controls button { 
  border-radius: 0 !important;
  background: #FFE3F1 !important;
  border: 2px outset #FFE3F1 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
  padding: 2px 6px !important;
}
body.theme-win95pink .danmaku-controls button:hover {
  background: #FFE3F1 !important;
  border: 2px inset #FFE3F1 !important;
}
body.theme-win95pink .danmaku-toggle { 
  border-radius: 0 !important;
  background: #FFE3F1 !important;
  border: 2px outset #FFE3F1 !important;
  font-family: 'MS Sans Serif', 'Microsoft Sans Serif', sans-serif !important;
  font-size: 11px !important;
  color: #000000 !important;
}

body.theme-lilac .danmaku-header { border-radius: 0; }
body.theme-lilac .danmaku-form { border-radius: 6px; }
body.theme-lilac .danmaku-input input { border-radius: 4px; }
body.theme-lilac .danmaku-controls select { border-radius: 4px; }
body.theme-lilac .danmaku-controls button { border-radius: 4px; }
body.theme-lilac .danmaku-toggle { border-radius: 4px; }

body.theme-darkpink .danmaku-header{ background: linear-gradient(180deg, var(--panel), color-mix(in srgb, var(--accent) 22%, var(--panel))); }
body.theme-darkpink .danmaku-content{ background: var(--panel); }

.fullscreen .danmaku-control-btn {
  background: rgba(0,0,0,0.5);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
}

.fullscreen .danmaku-control-btn:hover {
  background: rgba(255,255,255,0.2);
}