<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-title="channels.pageTitle">–ö–∞–Ω–∞–ª—ã | Youvi</title>
    <script>
        const CH_LIST_DEBUG = false;
        
        (function() {
            var theme = localStorage.getItem('youvi-theme');
            var sidebar = localStorage.getItem('sidebarCollapsed');
            
            var htmlClasses = [];
            if (theme === 'dark') htmlClasses.push('dark-theme');
            else if (theme === 'skeuo') htmlClasses.push('skeuo-theme');
            if (sidebar === 'true') htmlClasses.push('sidebar-collapsed');
            if (htmlClasses.length) document.documentElement.className = htmlClasses.join(' ');
        })();
    </script>
    <link rel="stylesheet" href="youvi/header/youvi-header.css">
    <script src="youvi/sidebar-toggle.js"></script>
    <script src="youvi/sidebar-scroll.js"></script>
    <script src="youvi/header/youvi-header.js"></script>
    
    <!-- i18n System -->
    <script src="youvi/i18n/ru.js"></script>
    <script src="youvi/i18n/en.js"></script>
    <script src="youvi/i18n/uk.js"></script>
    <script src="youvi/i18n/i18n.js"></script>
    
    <link rel="stylesheet" href="youvi/sidebar.css">
    <link rel="stylesheet" href="youvi/sidebar-scroll.css">
    <link rel="stylesheet" href="youvi/pagination.css">
    
    <!-- Theme System -->
    <link rel="stylesheet" href="youvi/themes/dark-theme.css">
    <link rel="stylesheet" href="youvi/themes/theme-dropdown.css">

    <link rel="stylesheet" href="youvi/sticky-video.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #fff;
            color: #111;
        }

        .top-nav {
            background: #d94b88;
            border-bottom: 1px solid #c2185b;
            padding: 4px 0;
        }

        .top-nav-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .top-nav a {
            color: #fff;
            text-decoration: none;
            font-size: 12px;
            padding: 2px 0;
            transition: color 0.2s;
        }

        .top-nav a:hover {
            color: #ffd6ea;
        }

        .top-nav a.active {
            color: #ffd6ea;
            font-weight: 600;
        }

        .header {
            background: #FFE7F4; 
            padding: 0;
            border-bottom: 1px solid #f2cfe1;
            min-height: 40px;
            width: 100%; 
        }

        .header-content-wrapper {
            display: flex;
            align-items: center;
            position: relative;
            box-sizing: border-box;
            max-width: 1600px; 
            margin: 0 auto; 
            padding: 0 20px; 
            width: 100%; 
            min-height: 40px; 
        }

        .sidebar-toggle-btn {
            width: 30px;
            height: 30px;
            background: transparent;
            border: none;
            border-radius: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #111;
            transition: background-color 0.2s;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .sidebar-toggle-btn:hover {
            background: transparent;
        }

        .sidebar-toggle-btn svg {
            width: 16px;
            height: 16px;
            fill: #111;
        }

        .sidebar-collapsed .sidebar,
        html.sidebar-collapsed .sidebar {
            width: 60px !important;
            padding: 10px 8px !important;
            display: block !important;
            position: sticky !important;
            top: 40px !important;
            max-height: calc(var(--sidebar-max-height, 100vh) - 75px) !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
        }

        .sidebar-collapsed .sidebar-title,
        html.sidebar-collapsed .sidebar-title {
            display: none !important;
        }

        .sidebar-collapsed .sidebar-item,
        html.sidebar-collapsed .sidebar-item {
            padding: 8px !important;
            padding-left: 5px !important;
            padding-right: 8px !important;
            justify-content: center !important;
            border-left: 3px solid transparent !important;
            border-radius: 4px;
            font-size: 0 !important;
        }

        .sidebar-collapsed .sidebar-item svg,
        html.sidebar-collapsed .sidebar-item svg {
            margin: 0 !important;
            width: 20px !important;
            height: 20px !important;
        }

        .sidebar-collapsed .container,
        html.sidebar-collapsed .container {
            padding-left: 20px;
        }

        .sidebar-collapsed .content-wrapper,
        html.sidebar-collapsed .content-wrapper {
            max-width: 1500px;
        }

        .nav-bar {
            display: flex;
            align-items: center;
            width: 100%; 
            justify-content: space-between;
            height: 100%;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            margin-left: calc(200px + 20px + 20px); 
        }

        .nav-right-actions {
            display: flex;
            align-items: center;
            gap: 15px; 
        }

        .nav-links a {
            color: #111; 
            text-decoration: none;
            font-size: 13px;
            padding: 5px 0;
        }



        .search-btn {
            padding: 8px 15px;
            background: #ff69b4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .user-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .user-actions a {
            color: #111; 
            text-decoration: none;
            font-size: 13px;
            transition: color 0.2s;
        }

        .user-actions a:hover {
            color: #ff69b4;
        }


        .container {
            width: 100%;
            margin: 0;
            padding: 0 20px;
            display: flex;
            gap: 20px;
            align-items: stretch;
            min-height: calc(100vh - 200px);
        }
        
        .content-wrapper {
            display: flex;
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            gap: 20px;
        }
        
        @media (min-width: 1700px) {
            .content-wrapper {
                max-width: 1500px;
            }
        }
        
        @media (min-width: 2000px) {
            .content-wrapper {
                max-width: 1600px;
            }
        }
        
        .header-content-wrapper,
        .top-nav-content {
            max-width: none !important;
            margin: 0 !important;
        }
		
		html, body {
            height: 100%;
        }

        .sidebar {
            width: 200px;
            flex-shrink: 0;
            background: #f5f5f5;
            margin-left: -20px;
            padding-left: 20px;
            padding-top: 10px;
            padding-bottom: 0;
        }

        .sidebar-section {
            margin-bottom: 15px;
        }

        .sidebar-section:last-child {
            margin-bottom: 0;
        }

        .sidebar-title {
            font-size: 14px;
            color: #999;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding-bottom: 40px;
        }

        .main-content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            margin-top: 5px;
            padding: 0 20px;
        }

        .channels-stats {
            font-size: 14px;
            color: #666;
            margin: 0;
            padding: 0;
            flex-shrink: 0;
        }

        .section-title {
            font-size: 24px; 
            margin-bottom: 15px;
            color: #111;
        }

        .channels-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 0 20px 0 20px;
            contain: layout style paint;
        }

        .channel-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #eee;
            cursor: pointer;
            padding: 10px;
            will-change: transform;
            transform: translateZ(0);
        }

        .subscribe-toggle-btn {
            margin-top: 8px;
            padding: 4px 8px;
            font-size: 11px;
            border: none;
            border-radius: 4px;
            background: #ff69b4;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
        }
        .subscribe-toggle-btn.subscribed {
            background: #666;
            color: #fff;
        }



        .channel-avatar {
            width: 80px;
            height: 80px;
            margin-bottom: 8px;
            background: #ff69b4;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: white;
            border: 2px solid #f0f0f0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .channel-info {
            width: 100%;
            text-align: center;
        }

        .channel-name {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            color: #111;
        }

        .channel-name a {
            color: #ff69b4;
            text-decoration: none;
        }

        .channel-name a:hover {
            text-decoration: underline;
        }

        .channel-stats {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 10px;
            color: #666;
            line-height: 1.2;
        }

        .channel-stat {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .channel-stat::before {
            font-size: 8px;
        }




        .empty-state {
            text-align: center;
            color: #666;
            padding: 60px 20px;
            font-size: 16px;
        }

        .footer {
            background: #2c2c2c;
            color: #fff;
            padding: 25px 0 15px 0;
            margin-top: 0;
        }

        .footer-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .footer-logo {
            flex-shrink: 0;
            width: 200px;
        }

        .footer-logo img {
            height: 40px;
            width: auto;
        }

        .footer-logo p {
            margin-top: 8px;
            font-size: 11px;
            color: #ccc;
            line-height: 1.3;
        }

        .footer-sections {
            display: flex;
            gap: 30px;
            flex: 1;
        }

        .footer-main {
            display: flex;
            gap: 30px;
            flex: 1;
        }

        .footer-right {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .footer-mascot {
            flex-shrink: 0;
        }

        .footer-mascot img {
            height: 180px;
            width: auto;
        }

        .footer-section {
            flex: 1;
        }

        .footer-section h3 {
            font-size: 13px;
            margin-bottom: 10px;
            color: #fff;
            font-weight: 600;
        }

        .footer-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-section li {
            margin-bottom: 6px;
        }

        .footer-section a {
            color: #ccc;
            text-decoration: none;
            font-size: 11px;
            transition: color 0.2s;
        }

        .footer-section a:hover {
            color: #ff69b4;
        }

        .footer-bottom {
            border-top: 1px solid #444;
            margin-top: 20px;
            padding-top: 15px;
            text-align: center;
            color: #999;
            font-size: 10px;
        }

        @media (max-width: 1024px) {
            .sidebar-right {
                display: none;
            }
            
            .channels-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 10px;
            }
            
            .sidebar {
                width: 100%;
                display: flex;
                overflow-x: auto;
                gap: 20px;
                padding: 10px 0;
                margin-bottom: 20px;
            }
            
            .sidebar-section {
                flex-shrink: 0;
                margin-bottom: 0;
            }
            
            .nav-links {
                display: none;
            }
            

            
            .channels-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
                padding: 0 10px;
            }
        }

        @media (max-width: 480px) {
            .nav-bar {
                padding: 0 10px;
            }
            

            
            .channels-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .section-title {
                font-size: 18px;
            }
        }

        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .footer-sections {
                flex-direction: column;
                gap: 15px;
            }
            
            .footer-main {
                flex-direction: column;
                gap: 20px;
            }
            
            .footer-right {
                width: 100%;
                flex-direction: column;
                align-items: center;
                gap: 15px;
                margin-top: 15px;
            }
            
            .footer-mascot img {
                height: 120px;
            }
            
            .footer-section {
                text-align: center;
            }
        }

        @media (min-width: 1700px) {
            .footer-content {
                max-width: 1700px !important;
            }
        }

        @media (min-width: 2000px) {
            .footer-content {
                max-width: 1800px !important;
            }
        }

                body.dark-theme input.search-input {
  background: #4a3a34 !important;
  color: #fff !important;
  border-color: #555 !important;
}

        .lang-switcher {
            margin-left: auto;
        }
        
        .lang-select {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            outline: none;
        }
        
        .lang-select:hover {
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .lang-select option {
            background: #d94b88;
            color: #fff;
        }
    </style>
</head>
<link rel="icon" href="favicon/youvi/favicon.ico" type="image/x-icon">
<body>
    <!-- Top Navigation Bar -->
    <div class="top-nav">
        <div class="top-nav-content">
      <a href="youvi_main.html" data-i18n="nav.video">–í–∏–¥–µ–æ</a>
      <a href="index.html" data-i18n="nav.management">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</a>
      <a href="youvi_ch_list.html" class="active" data-i18n="nav.channels">–ö–∞–Ω–∞–ª—ã</a>
      <a href="youvi_playlists_list.html" data-i18n="nav.playlists">–ü–ª–µ–π–ª–∏—Å—Ç—ã</a>
      <a href="youvi_feed_all.html" data-i18n="nav.feed">Feed</a> 
      <a href="wiki/index.html" data-i18n="nav.wiki">Wiki</a>
      <div class="lang-switcher">
        <select id="langSwitcher" class="lang-select">
          <option value="ru">üá∑üá∫ RU</option>
          <option value="en">üá¨üáß EN</option>
          <option value="uk">üá∫üá¶ UK</option>
        </select>
      </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content-wrapper">
            <div class="header-left">
                <button id="sidebarToggle" class="sidebar-toggle-btn" aria-label="Toggle sidebar">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </button>
                
                <div class="logo">
                    <a href="youvi_main.html">
                        <img src="images/logo_youvi_ind.png" alt="Youvi logo">
                    </a>
                </div>
            </div>
            
            <div class="header-center">
                <div class="search-area autocomplete-wrapper">
                    <input type="text" id="globalSearch" placeholder="–ü–æ–∏—Å–∫ –≤–∏–¥–µ–æ..." class="search-input" data-i18n-placeholder="search.placeholder">
                    <button id="doSearch" class="search-btn" data-i18n="search.button">–ù–∞–π—Ç–∏</button>
                </div>
            </div>
            
            <div class="header-right">
                <div class="user-actions">

                    <div class="settings-container">
                        <a href="#" class="settings-btn">‚öô</a>
                        <div class="theme-dropdown">
                            <button class="theme-dropdown-item" data-theme="light">–ë–µ–ª–∞—è</button>
                            <button class="theme-dropdown-item" data-theme="dark">–ß–µ—Ä–Ω–∞—è</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title" data-i18n="sidebar.navigation">–ù–∞–≤–∏–≥–∞—Ü–∏—è</div>
                <a href="youvi_main.html" class="sidebar-item nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9,22 9,12 15,12 15,22"/>
                    </svg>
                    <span data-i18n="sidebar.home">–ì–ª–∞–≤–Ω–∞—è</span>
                </a>
                <a href="youvi_feed_all.html" class="sidebar-item nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                        <path d="M4 11a9 9 0 0 1 9 9"/>
                        <path d="M4 4a16 16 0 0 1 16 16"/>
                        <path d="M5 20a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                    </svg>
                    <span data-i18n="sidebar.feed">Feed</span>
                </a>
                <a href="youvi_tags.html" class="sidebar-item nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#ff69b4" stroke-width="1.5">
                       <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                    <line x1="7" y1="7" x2="7.01" y2="7"/>
                   </svg>
                      <span data-i18n="sidebar.allTags">–í—Å–µ —Ç–µ–≥–∏</span>
                  </a>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title" data-i18n="sidebar.library">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</div>
                <a href="youvi_history.html" class="sidebar-item library-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12,6 12,12 16,14"/>
                    </svg>
                    <span data-i18n="sidebar.history">–ò—Å—Ç–æ—Ä–∏—è</span>
                </a>
                <a href="youvi_fav.html" class="sidebar-item library-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                    <span data-i18n="sidebar.favorites">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                </a>
                <a href="youvi_playlists_list.html" class="sidebar-item library-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <line x1="8" y1="8" x2="16" y2="8"/>
                        <line x1="8" y1="12" x2="16" y2="12"/>
                        <line x1="8" y1="16" x2="16" y2="16"/>
                        <circle cx="6" cy="8" r="1"/>
                        <circle cx="6" cy="12" r="1"/>
                        <circle cx="6" cy="16" r="1"/>
                    </svg>
                    <span data-i18n="sidebar.playlists">–ü–ª–µ–π–ª–∏—Å—Ç—ã</span>
                </a>
                <a href="youvi_ch_list.html" class="sidebar-item library-item active">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 1-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <span data-i18n="sidebar.channels">–ö–∞–Ω–∞–ª—ã</span>
                </a>
                <a href="youvi_subscriptions.html" class="sidebar-item library-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                        <rect x="2" y="7" width="20" height="15" rx="2" ry="2"/>
                        <polyline points="17,2 12,7 7,2"/>
                    </svg>
                    <span data-i18n="sidebar.subscriptions">–ü–æ–¥–ø–∏—Å–∫–∏</span>
                </a>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title" data-i18n="sidebar.subscriptionsTitle">–ü–æ–¥–ø–∏—Å–∫–∏</div>
                <div id="subscribedChannelsContainer"></div>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title" data-i18n="sidebar.sorting">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</div>
                <div id="sortOptionsContainer">
                    <a href="#" class="sidebar-item library-item" id="sortPopular">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                        </svg>
                        <span data-i18n="sidebar.sortPopular">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</span>
                    </a>
                    <a href="#" class="sidebar-item library-item" id="sortNew">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12,6 12,12 16,14"/>
                        </svg>
                        <span data-i18n="sidebar.sortNew">–ù–æ–≤—ã–µ</span>
                    </a>
                    <a href="#" class="sidebar-item library-item" id="sortVideos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                            <line x1="8" y1="21" x2="16" y2="21"/>
                            <line x1="12" y1="17" x2="12" y2="21"/>
                        </svg>
                        <span data-i18n="channels.sortByVideos">–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤–∏–¥–µ–æ</span>
                    </a>
                    <a href="#" class="sidebar-item library-item" id="sortViews">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        <span data-i18n="channels.sortByViews">–ü–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º</span>
                    </a>
                    <a href="#" class="sidebar-item library-item" id="sortAlphabetical">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="1.5">
                            <path d="M4 16L8 6l4 10"/>
                            <path d="M5 13h6"/>
                            <path d="M14 6h6"/>
                            <path d="M14 12h6"/>
                            <path d="M14 18h6"/>
                        </svg>
                        <span data-i18n="sidebar.sortAlphabetical">–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</span>
                    </a>
                </div>
            </div>

        </aside>

        <!-- Content Wrapper (centered) -->
        <div class="content-wrapper">
        <!-- Main Content -->
        <main class="main-content">
            <div class="main-content-header">
                <h1 class="section-title" data-i18n="channels.title">–ö–∞–Ω–∞–ª—ã</h1>
                <div class="channels-stats">
                    <span id="channelsCount" data-i18n="channels.defaultCount">0 –∫–∞–Ω–∞–ª–æ–≤</span>
                </div>
            </div>

            <div id="channelsContainer">
                <!-- Channels will be rendered here -->
            </div>

            <div id="paginationContainer">
            </div>
        </main>
        </div><!-- /content-wrapper -->

    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-main">
                <div class="footer-logo">
                    <img src="images/logo_youvi_ind_ex.png" alt="Youvi" loading="lazy">
                    <p data-i18n="footer.description">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–π—Ç–µ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∏–¥–µ–æ.</p>
                </div>
                <div class="footer-sections">
                    <div class="footer-section">
                        <h3 data-i18n="footer.sections">–†–∞–∑–¥–µ–ª—ã</h3>
            <ul>
              <li><a href="youvi_main.html" data-i18n="footer.video">–í–∏–¥–µ–æ</a></li>
              <li><a href="youvi_tags.html" data-i18n="sidebar.tags">–¢–µ–≥–∏</a></li>
              <li><a href="youvi_feed_all.html" data-i18n="nav.feed">Feed</a></li>
              <li><a href="index.html" data-i18n="nav.management">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h3 data-i18n="sidebar.library">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</h3>
            <ul>
              <li><a href="youvi_ch_list.html" data-i18n="sidebar.channels">–ö–∞–Ω–∞–ª—ã</a></li>
              <li><a href="youvi_playlists_list.html" data-i18n="sidebar.playlists">–ü–ª–µ–π–ª–∏—Å—Ç—ã</a></li>
              <li><a href="youvi_subscriptions.html" data-i18n="sidebar.subscriptions">–ü–æ–¥–ø–∏—Å–∫–∏</a></li>
              <li><a href="youvi_fav.html" data-i18n="sidebar.favorites">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a></li>
              <li><a href="youvi_history.html" data-i18n="sidebar.history">–ò—Å—Ç–æ—Ä–∏—è</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h3 data-i18n="nav.wiki">Wiki</h3>
            <ul>
              <li><a href="wiki/index.html" data-i18n="sidebar.home">–ì–ª–∞–≤–Ω–∞—è</a></li>
              <li><a href="wiki/player.html" data-i18n="footer.wiki.player">–ü–ª–µ–µ—Ä</a></li>
              <li><a href="wiki/danmaku.html" data-i18n="footer.wiki.danmaku">–î–∞–Ω–º–∞–∫—É</a></li>
              <li><a href="wiki/tags/general.html" data-i18n="sidebar.tags">–¢–µ–≥–∏</a></li>
              <li><a href="wiki/tags/rules.html" data-i18n="footer.wiki.taggingRules">–ü—Ä–∞–≤–∏–ª–∞ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</a></li>
              <li><a href="wiki/search/general.html" data-i18n="footer.wiki.search">–ü–æ–∏—Å–∫</a></li>
            </ul>
          </div>
                    <div class="footer-section">
                        <h3 data-i18n="footer.pgc">PGC</h3>
                        <ul>
                            <li><a href="youvi_main.html?tag=Anime (ct)" data-i18n="footer.categories.anime">Anime</a></li>
                            <li><a href="youvi_main.html?tag=Animation (ct)" data-i18n="footer.categories.animation">Animation</a></li>
                            <li><a href="youvi_main.html?tag=Movies (ct)" data-i18n="footer.categories.movies">Movies</a></li>
                            <li><a href="youvi_main.html?tag=Series (ct)" data-i18n="footer.categories.series">Series</a></li>
                            <li><a href="youvi_main.html?tag=Music (ct)" data-i18n="footer.categories.music">Music</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h3 data-i18n="footer.ugc">UGC</h3>
                        <ul>
                            <li><a href="youvi_main.html?tag=Games (ct)" data-i18n="footer.categories.games">Games</a></li>
                            <li><a href="youvi_main.html?tag=Technology (ct)" data-i18n="footer.categories.tech">Technology</a></li>
                            <li><a href="youvi_main.html?tag=Entertainment (ct)" data-i18n="footer.categories.entertainment">Entertainment</a></li>
                            <li><a href="youvi_main.html?tag=IRL (ct)" data-i18n="footer.categories.irl">IRL</a></li>
                            <li><a href="youvi_main.html?tag=TV (ct)" data-i18n="footer.categories.tv">TV</a></li>
                            <li><a href="youvi_main.html?tag=Education (ct)" data-i18n="footer.categories.education">Education</a></li>
                            <li><a href="youvi_main.html?tag=Other (ct)" data-i18n="footer.categories.other">Other</a></li>
                        </ul>
                    </div>
          <div class="footer-section">
            <h3 data-i18n="footer.about">–û —Å–∞–π—Ç–µ</h3>
            <ul>
              <li><a href="wiki/about.html" data-i18n="footer.aboutSite">–ü—Ä–æ —Å–∞–π—Ç</a></li>
               <li><a href="wiki/docs.html" data-i18n="footer.docs">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a></li>
              <li><a href="wiki/tech.html" data-i18n="footer.tech">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</a></li>
            </ul>
                    </div>
                </div>
            </div>
            <div class="footer-right">
                <div class="footer-mascot">
                    <img src="images/mascot1.png" alt="Yuvi" loading="lazy">
                </div>
            </div>
        </div>
    </footer>

    <script>
        let allChannels = [];
        let filteredChannels = [];
        let currentPage = 1;
        let channelsPerPage = 48;
        let currentSort = 'popular';
        let currentSearchQuery = '';
        let videoDirectoryHandle = null;
        const supportsFS = 'showDirectoryPicker' in window;
        let currentSubscriptions = [];
        
        const channelCache = new Map();
        const searchCache = new Map();
        const filterCache = new Map();
        let lastRenderTime = 0;
        const RENDER_THROTTLE = 100;

        async function loadAllVideosAndPlaylistsForAutocomplete() {
          if (typeof AutocompleteDataLoader === 'undefined') {
            console.error('[Autocomplete] AutocompleteDataLoader module not loaded');
            return { videos: [], playlists: [] };
          }
          
          const result = await AutocompleteDataLoader.loadData();
          return { videos: result.videos || [], playlists: result.playlists || [] };
        }

        document.addEventListener('DOMContentLoaded', async function() {
            if (!supportsFS) {
                document.getElementById('channelsContainer').innerHTML = 
                    '<div class="empty-state" style="color:red"><strong>File System API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome/Edge.</strong></div>';
                return;
            }

            try {
                const db = await openDB();
                const savedHandle = await getFromDB(db, 'videoDirectoryHandle');
                
                if (savedHandle) {
                    const permission = await savedHandle.queryPermission();
                    if (permission === 'granted' || (permission === 'prompt' && await savedHandle.requestPermission() === 'granted')) {
                        videoDirectoryHandle = savedHandle;
                        currentSubscriptions = await loadSubscriptionsFromFile() || [];
                        await loadChannels();
                        await renderSubscribedChannelsList();
                        
                        try {
                          const searchInput = document.getElementById('globalSearch');
                          if (searchInput && typeof AutocompleteIntegration !== 'undefined' && typeof YouviAutocomplete !== 'undefined') {
                            const { videos, playlists } = await loadAllVideosAndPlaylistsForAutocomplete();
                            
                            const cacheValid = await window.autocompleteCache.isCacheValid(
                              videos.length,
                              playlists.length
                            );
                            
                            const autocompleteIntegration = new AutocompleteIntegration();
                            await autocompleteIntegration.init(searchInput, {
                              videoDirectoryHandle: videoDirectoryHandle,
                              allVideos: cacheValid ? [] : videos,
                              allPlaylists: cacheValid ? [] : playlists
                            });
                            if (CH_LIST_DEBUG) console.log('[Autocomplete] ‚úÖ Initialized on youvi_ch_list.html');
                          }
                        } catch (error) {
                          console.error('[Autocomplete] Failed to initialize:', error);
                        }
                    } else {
                        document.getElementById('channelsContainer').innerHTML = 
                            '<div class="empty-state"><strong>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ —Å –≤–∏–¥–µ–æ</strong></div>';
                    }
                } else {
                    document.getElementById('channelsContainer').innerHTML = 
                        '<div class="empty-state"><strong>–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å –≤–∏–¥–µ–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</strong></div>';
                }
            } catch (e) {
                console.error('Error accessing directory:', e);
                document.getElementById('channelsContainer').innerHTML = 
                    '<div class="empty-state" style="color:red"><strong>–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ</strong></div>';
            }
            
            setupEventListeners();
            
            document.getElementById('sortPopular').classList.add('active');

            window.addEventListener('subscriptionChanged', async () => {
                try {
                    currentSubscriptions = await loadSubscriptionsFromFile() || [];
                    await renderSubscribedChannelsList();
                    renderChannels();
                } catch (e) {
                    console.error('Error updating subscriptions:', e);
                }
            });
        });

        async function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('8SiteDB', 1);
                request.onupgradeneeded = () => {
                    const db = request.result;
                    if (!db.objectStoreNames.contains('handles')) {
                        db.createObjectStore('handles');
                    }
                };
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function getFromDB(db, key) {
            const tx = db.transaction('handles', 'readonly');
            const store = tx.objectStore('handles');
            return new Promise((resolve) => {
                const request = store.get(key);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => resolve(null);
            });
        }

        async function readJSONFile(dirHandle, fileName, defaultValue = null) {
            try {
                const fileHandle = await dirHandle.getFileHandle(fileName);
                const file = await fileHandle.getFile();
                const text = await file.text();
                return JSON.parse(text);
            } catch (e) {
                return defaultValue;
            }
        }

        async function loadImageFile(dirHandle, fileName) {
            try {
                const fileHandle = await dirHandle.getFileHandle(fileName);
                const file = await fileHandle.getFile();
                return URL.createObjectURL(file);
            } catch (e) {
                return null;
            }
        }

        async function ensureSubscriptionsDir() {
            try {
                if (!videoDirectoryHandle) return null;
                return videoDirectoryHandle;
            } catch (_) {
                return null;
            }
        }

        async function loadSubscriptionsFromFile() {
            try {
                const local = localStorage.getItem('8site_subscriptions');
                if (local) {
                    const parsed = JSON.parse(local);
                    if (Array.isArray(parsed)) return parsed;
                }
                if (videoDirectoryHandle) {
                    const dir = await ensureSubscriptionsDir();
                    if (dir) {
                        const fh = await dir.getFileHandle('.subscriptions.json');
                        const f = await fh.getFile();
                        const text = await f.text();
                        const subs = JSON.parse(text);
                        if (Array.isArray(subs)) {
                            localStorage.setItem('8site_subscriptions', JSON.stringify(subs));
                            return subs;
                        }
                    }
                }
            } catch (_) {}
            return [];
        }

        async function saveSubscriptionsToFile(subscriptions) {
            try {
                localStorage.setItem('8site_subscriptions', JSON.stringify(subscriptions));
                if (videoDirectoryHandle) {
                    const dir = await ensureSubscriptionsDir();
                    if (dir) {
                        const fh = await dir.getFileHandle('.subscriptions.json', { create: true });
                        const w = await fh.createWritable();
                        await w.write(JSON.stringify(subscriptions, null, 2));
                        await w.close();
                    }
                }
                window.dispatchEvent(new CustomEvent('subscriptionChanged'));
            } catch (_) {}
        }

        const avatarCache = new Map();

        async function loadImageFile(dirHandle, name) {
            try {
                const fileHandle = await dirHandle.getFileHandle(name);
                const file = await fileHandle.getFile();
                return URL.createObjectURL(file);
            } catch (e) {
                return null;
            }
        }

        async function loadChannelAvatar(channelName) {
            const cacheKey = `avatar_${channelName}`;
            if (avatarCache.has(cacheKey)) {
                const cached = avatarCache.get(cacheKey);
                if (Date.now() - cached.timestamp < 300000) {
                    return cached.url;
                }
                if (cached.url && cached.url.startsWith('blob:')) {
                    URL.revokeObjectURL(cached.url);
                }
                avatarCache.delete(cacheKey);
            }

            try {
                const channelsDir = await videoDirectoryHandle.getDirectoryHandle('.channels', { create: true });
                const channelDir = await channelsDir.getDirectoryHandle(channelName, { create: true });

                const channelData = await readJSONFile(channelDir, 'channel.json', {});
                let avatarUrl = null;

                if (channelData.avatar) {
                    avatarUrl = await loadImageFile(channelDir, channelData.avatar);
                }

                avatarCache.set(cacheKey, {
                    url: avatarUrl,
                    timestamp: Date.now()
                });

                return avatarUrl;
            } catch (e) {
                avatarCache.set(cacheKey, {
                    url: null,
                    timestamp: Date.now()
                });
                return null;
            }
        }

        async function renderSubscribedChannelsList() {
            const sidebarContainer = document.getElementById('subscribedChannelsContainer');
            if (!sidebarContainer) return;

            try {
                const savedSubscriptions = await loadSubscriptionsFromFile();
                const subscribedChannels = Array.isArray(savedSubscriptions) ? savedSubscriptions : [];

                sidebarContainer.innerHTML = '';

                if (subscribedChannels.length === 0) {
                    const noSubs = document.createElement('div');
                    noSubs.className = 'sidebar-item';
                    noSubs.style.fontStyle = 'italic';
                    noSubs.style.color = '#999';
                    noSubs.textContent = i18n.t('sidebar.noSubscriptions', '–ù–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫');
                    sidebarContainer.appendChild(noSubs);
                    return;
                }

                subscribedChannels.forEach((channelName, index) => {
                    const link = document.createElement('a');
                    link.href = '#';
                    link.className = 'sidebar-item';
                    link.dataset.channel = channelName;
                    link.id = `sidebar_channel_${index}`;
                    link.style.display = 'flex';
                    link.style.alignItems = 'center';
                    link.style.gap = '8px';

                    const avatar = document.createElement('div');
                    avatar.style.cssText = `
                        width: 20px;
                        height: 20px;
                        border-radius: 0;
                        background: #ff69b4;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        font-size: 10px;
                        flex-shrink: 0;
                        background-size: cover;
                        background-position: center;
                        background-repeat: no-repeat;
                        cursor: pointer;
                    `;
                    avatar.textContent = channelName.charAt(0).toUpperCase();
                    avatar.title = i18n.t('channels.goToChannel', '–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞–Ω–∞–ª—É');

                    const textSpan = document.createElement('span');
                    textSpan.textContent = channelName;
                    textSpan.style.overflow = 'hidden';
                    textSpan.style.textOverflow = 'ellipsis';
                    textSpan.style.whiteSpace = 'nowrap';
                    textSpan.style.flex = '1';

                    link.appendChild(avatar);
                    link.appendChild(textSpan);

                    avatar.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        window.location.href = `youvi_ch_view.html?channel=${encodeURIComponent(channelName)}`;
                    });

                    textSpan.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        window.location.href = `youvi_ch_view.html?channel=${encodeURIComponent(channelName)}`;
                    });

                    loadChannelAvatar(channelName).then(avatarUrl => {
                        if (avatarUrl) {
                            avatar.style.backgroundImage = `url(${avatarUrl})`;
                            avatar.textContent = '';
                        }
                    }).catch(() => {
                    });

                    sidebarContainer.appendChild(link);
                });
            } catch (e) {
                console.error('Error loading subscriptions:', e);
                sidebarContainer.innerHTML = `<div class="sidebar-item" style="font-style: italic; color: #999;">${i18n.t('sidebar.loadingError', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')}</div>`;
            }
        }

async function loadChannels() {
    if (!videoDirectoryHandle) return;
    
    allChannels = [];
    const allTags = new Set();
    const allVideoMetadata = {};
    const channelVideoMap = {};

    try {
        if (CH_LIST_DEBUG) console.log('–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∫–∞–Ω–∞–ª–æ–≤...');
        const startTime = performance.now();
        
        await collectAllVideoMetadata(videoDirectoryHandle, allVideoMetadata, channelVideoMap);

        const channelsDir = await videoDirectoryHandle.getDirectoryHandle('.channels', { create: false });
        
        const channelEntries = [];
        for await (const [channelName, channelHandle] of channelsDir.entries()) {
            if (channelHandle.kind === 'directory') {
                channelEntries.push([channelName, channelHandle]);
            }
        }
        
        if (CH_LIST_DEBUG) console.log(`–ù–∞–π–¥–µ–Ω–æ –∫–∞–Ω–∞–ª–æ–≤: ${channelEntries.length}`);
        
        const BATCH_SIZE = 10;
        let processedCount = 0;
        
        for (let i = 0; i < channelEntries.length; i += BATCH_SIZE) {
            const batch = channelEntries.slice(i, i + BATCH_SIZE);
            
            await Promise.all(
                batch.map(async ([channelName, channelHandle]) => {
                    try {
                        const channelData = await readJSONFile(channelHandle, 'channel.json', {
                            name: channelName,
                            description: '',
                            avatar: null,
                            header: null,
                            created: Date.now(),
                            feed: [],
                            playlists: []
                        });
                        
                        let avatarUrl = null;
                        if (channelData.avatar) {
                            avatarUrl = await loadImageFile(channelHandle, channelData.avatar);
                        }
                        
                        const channelStats = getChannelStats(channelName, channelVideoMap[channelName] || []);
                        
                        channelStats.tags.forEach(tag => allTags.add(tag));
                        
                        allChannels.push({
                            name: channelName,
                            description: channelData.description || '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –∑–∞–¥–∞–Ω–æ',
                            avatar: avatarUrl,
                            videoCount: channelStats.videoCount,
                            viewCount: channelStats.viewCount,
                            tags: channelStats.tags,
                            created: channelData.created
                        });
                        
                        processedCount++;
                    } catch (e) {
                        console.error('Error loading channel:', channelName, e);
                    }
                })
            );
            
            if (CH_LIST_DEBUG) console.log(`–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–∞–Ω–∞–ª–æ–≤: ${processedCount}/${channelEntries.length}`);
            
            if (i % 30 === 0) {
                await new Promise(resolve => setTimeout(resolve, 0));
            }
        }
        
        allChannels.sort((a, b) => b.created - a.created);
        
        const endTime = performance.now();
        if (CH_LIST_DEBUG) console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allChannels.length} –∫–∞–Ω–∞–ª–æ–≤ –∑–∞ ${(endTime - startTime).toFixed(0)}–º—Å`);
        
        filterChannels();
        
    } catch (e) {
        console.error('Error loading channels:', e);
        document.getElementById('channelsContainer').innerHTML = 
            `<div class="empty-state">${i18n.t('channels.noChannels', '–ö–∞–Ω–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã')}</div>`;
    }
}

        async function getVideoMetadata(dirHandle, fileName) {
            try {
                const metaDir = await dirHandle.getDirectoryHandle('.metadata', { create: true });
                const metaFileName = fileName + '.meta.json';
                const fileHandle = await metaDir.getFileHandle(metaFileName);
                const file = await fileHandle.getFile();
                const text = await file.text();
                return JSON.parse(text);
            } catch (e) {
                return {
                    views: 0,
                    likes: 0,
                    dislikes: 0,
                    tags: [],
                    created: Date.now()
                };
            }
        }

async function collectAllVideoMetadata(dirHandle, allVideoMetadata, channelVideoMap) {
    const videoExtensions = ['.mp4', '.avi', '.mov', '.mkv', '.webm', '.m4v'];
    
    if (CH_LIST_DEBUG) console.log('–°–∫–∞–Ω–∏—Ä—É–µ–º –≤–∏–¥–µ–æ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö...');
    const startTime = performance.now();
    
    async function scanDir(dir, entries = []) {
        const items = [];
        for await (const [name, handle] of dir.entries()) {
            items.push([name, handle, dir]);
        }
        
        for (const [name, handle, parentDir] of items) {
            if (handle.kind === 'file') {
                const isVideo = videoExtensions.some(ext => name.toLowerCase().endsWith(ext));
                if (isVideo) {
                    entries.push([name, handle, parentDir]);
                }
            } else if (handle.kind === 'directory' && !name.startsWith('.')) {
                await scanDir(handle, entries);
            }
        }
        
        return entries;
    }
    
    const allEntries = await scanDir(dirHandle);
    if (CH_LIST_DEBUG) console.log(`–ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤: ${allEntries.length}`);
    
    const BATCH_SIZE = 50;
    let processed = 0;
    
    for (let i = 0; i < allEntries.length; i += BATCH_SIZE) {
        const batch = allEntries.slice(i, i + BATCH_SIZE);
        
        await Promise.all(
            batch.map(async ([name, handle, parentDir]) => {
                try {
                    const metadata = await getVideoMetadata(parentDir, name);
                    allVideoMetadata[name] = metadata;
                    
                    if (metadata.tags) {
                        metadata.tags.forEach(tag => {
                            const channelTagMatch = tag.match(/(.*) \(–∫–∞\)/);
                            if (channelTagMatch) {
                                const channelName = channelTagMatch[1];
                                if (!channelVideoMap[channelName]) {
                                    channelVideoMap[channelName] = [];
                                }
                                channelVideoMap[channelName].push(metadata);
                            }
                        });
                    }
                    processed++;
                } catch (e) {
                    console.warn(`–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö: ${name}`);
                }
            })
        );
        
        if (i % 200 === 0) {
            if (CH_LIST_DEBUG) console.log(`–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö: ${processed}/${allEntries.length}`);
        }
        
        if (i % 200 === 0) {
            await new Promise(resolve => setTimeout(resolve, 0));
        }
    }
    
    const endTime = performance.now();
    if (CH_LIST_DEBUG) console.log(`–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–∞ ${(endTime - startTime).toFixed(0)}–º—Å`);
}
        function getChannelStats(channelName, videosMetadata) {
            const stats = {
                videoCount: 0,
                viewCount: 0,
                tags: []
            };
            
            videosMetadata.forEach(metadata => {
                const hasChannelTag = (metadata.tags || []).some(tag => 
                    tag === `${channelName} (–∫–∞)`
                );
                
                if (hasChannelTag) {
                    stats.videoCount++;
                    stats.viewCount += metadata.views || 0;
                    
                    if (metadata.tags) {
                        metadata.tags.forEach(tag => {
                            if (tag !== `${channelName} (–∫–∞)` && !stats.tags.includes(tag)) {
                                stats.tags.push(tag);
                            }
                        });
                    }
                }
            });
            
            return stats;
        }

        function getViewsText(count) {
            const viewsLabel = i18n.t('channels.views', '–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤');
            return `${count.toLocaleString()} ${viewsLabel}`;
        }

        function getVideosText(count) {
            const videosLabel = i18n.t('channels.videos', '–≤–∏–¥–µ–æ');
            return `${count} ${videosLabel}`;
        }

        function setupEventListeners() {
            const searchBtn = document.getElementById('doSearch');
            const searchInput = document.getElementById('globalSearch');
            
            if (searchBtn) {
                searchBtn.addEventListener('click', (e)=>{
                    e.preventDefault();
                    const q=(document.getElementById('globalSearch').value||'').trim();
                    const params=new URLSearchParams();
                    if(q) params.set('q', q);
                    params.set('type','channels');
                    window.location.href = `youvi_search.html?${params.toString()}`;
                });
            }
            if (searchInput) {
                searchInput.addEventListener('keypress', (e)=>{
                    if(e.key==='Enter'){
                        e.preventDefault();
                        const q=(e.target.value||'').trim();
                        const params=new URLSearchParams();
                        if(q) params.set('q', q);
                        params.set('type','channels');
                        window.location.href = `youvi_search.html?${params.toString()}`;
                    }
                });
            }

            document.getElementById('sortPopular').addEventListener('click', (e) => {
                e.preventDefault();
                setActiveSort('popular');
            });
            
            document.getElementById('sortNew').addEventListener('click', (e) => {
                e.preventDefault();
                setActiveSort('new');
            });
            
            document.getElementById('sortVideos').addEventListener('click', (e) => {
                e.preventDefault();
                setActiveSort('videos');
            });
            
            document.getElementById('sortViews').addEventListener('click', (e) => {
                e.preventDefault();
                setActiveSort('views');
            });
            
            document.getElementById('sortAlphabetical').addEventListener('click', (e) => {
                e.preventDefault();
                setActiveSort('alphabetical');
            });

        }

        function searchChannels() {
            const searchInput = document.getElementById('globalSearch');
            const searchQuery = searchInput.value.trim();
            
            if (searchQuery) {
                currentSearchQuery = searchQuery;
                currentPage = 1;
                
                channelCache.clear();
                filterCache.clear();
                
                filterChannels();
            }
        }

        function filterChannels() {
            const term = document.getElementById('globalSearch').value.toLowerCase();
            const cacheKey = `all_${term}`;
            
            if (filterCache.has(cacheKey)) {
                filteredChannels = filterCache.get(cacheKey);
                currentPage = 1;
                renderChannels();
                updateSectionTitle();
                return;
            }
            
            filteredChannels = allChannels.filter(channel => {
                if (term) {
                    if (window.autocompleteCache && window.autocompleteCache.matchesWithTranslit) {
                        const nameMatch = window.autocompleteCache.matchesWithTranslit(channel.name || '', term);
                        const descMatch = window.autocompleteCache.matchesWithTranslit(channel.description || '', term);
                        if (!nameMatch && !descMatch) return false;
                    } else {
                        const t = (channel.name || '').toLowerCase().includes(term);
                        const d = (channel.description || '').toLowerCase().includes(term);
                        if (!t && !d) return false;
                    }
                }
                
                return true;
            });
            
            filterCache.set(cacheKey, [...filteredChannels]);
            
            currentPage = 1;
            renderChannels();
            updateSectionTitle();
        }

        function setActiveSort(sortType) {
            currentSort = sortType;
            currentPage = 1;
            
            channelCache.clear();
            
            document.querySelectorAll('#sortOptionsContainer .sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.getElementById(`sort${sortType.charAt(0).toUpperCase() + sortType.slice(1)}`).classList.add('active');
            
            renderChannels();
        }


        function renderChannels() {
            const now = Date.now();
            if (now - lastRenderTime < RENDER_THROTTLE) {
                setTimeout(() => renderChannels(), RENDER_THROTTLE - (now - lastRenderTime));
                return;
            }
            lastRenderTime = now;
            
            const container = document.getElementById('channelsContainer');
            if (!container) return;

            if (allChannels.length === 0) {
                container.innerHTML = `<div class="loading">${i18n.t('channels.loading', '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–Ω–∞–ª–æ–≤...')}</div>`;
                return;
            }

            updateSectionTitle();

            const sortCacheKey = `${currentSort}_${currentSearchQuery}`;
            let sortedChannels;
            
            if (channelCache.has(sortCacheKey)) {
                sortedChannels = channelCache.get(sortCacheKey);
            } else {
                sortedChannels = [...filteredChannels];
                sortedChannels.sort((a, b) => {
                    switch (currentSort) {
                        case 'popular':
                            return (b.viewCount || 0) - (a.viewCount || 0);
                        case 'new':
                            return (b.created || 0) - (a.created || 0);
                        case 'videos':
                            return (b.videoCount || 0) - (a.videoCount || 0);
                        case 'views':
                            return (b.viewCount || 0) - (a.viewCount || 0);
                        case 'alphabetical':
                            return (a.name || '').localeCompare(b.name || '');
                        default:
                            return 0;
                    }
                });
                channelCache.set(sortCacheKey, [...sortedChannels]);
            }

            const totalPages = Math.ceil(sortedChannels.length / channelsPerPage);
            const startIndex = (currentPage - 1) * channelsPerPage;
            const endIndex = startIndex + channelsPerPage;
            const pageChannels = sortedChannels.slice(startIndex, endIndex);

            container.innerHTML = '';
            
            if (pageChannels.length === 0) {
                container.innerHTML = `<div class="empty-state">${i18n.t('channels.noChannels', '–ö–∞–Ω–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã')}</div>`;
                return;
            }

            container.innerHTML = '<div class="channels-grid" id="channelsGrid"></div>';
            const grid = document.getElementById('channelsGrid');

            const fragment = document.createDocumentFragment();
            pageChannels.forEach(channel => {
                const channelCard = createChannelCard(channel);
                fragment.appendChild(channelCard);
            });
            grid.appendChild(fragment);

            renderPagination(totalPages, sortedChannels.length);
        }

        function createChannelCard(channel) {
            const card = document.createElement('div');
            card.className = 'channel-card';
            
            const avatar = document.createElement('div');
            avatar.className = 'channel-avatar';
            if (channel.avatar) {
                avatar.style.backgroundImage = `url(${channel.avatar})`;
            } else {
                avatar.textContent = channel.name.charAt(0).toUpperCase();
            }
            
            const info = document.createElement('div');
            info.className = 'channel-info';
            
            const name = document.createElement('div');
            name.className = 'channel-name';
            name.innerHTML = `<a href="youvi_ch_view.html?channel=${encodeURIComponent(channel.name)}">${escapeHtml(channel.name)}</a>`;
            
            const stats = document.createElement('div');
            stats.className = 'channel-stats';
            
            const videos = document.createElement('div');
            videos.className = 'channel-stat videos';
            videos.textContent = getVideosText(channel.videoCount || 0);
            
            const views = document.createElement('div');
            views.className = 'channel-stat views';
            views.textContent = getViewsText(channel.viewCount || 0);
            
            stats.appendChild(videos);
            stats.appendChild(views);
            
            const subBtn = document.createElement('button');
            subBtn.className = 'subscribe-toggle-btn';
            const initiallySubscribed = Array.isArray(currentSubscriptions) && currentSubscriptions.includes(channel.name);
            subBtn.textContent = initiallySubscribed ? i18n.t('video.subscribed', '–ü–æ–¥–ø–∏—Å–∞–Ω') : i18n.t('video.subscribe', '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è');
            if (initiallySubscribed) subBtn.classList.add('subscribed');
            subBtn.addEventListener('click', async (e) => {
                e.stopPropagation();
                try {
                    if (!Array.isArray(currentSubscriptions)) currentSubscriptions = [];
                    const idx = currentSubscriptions.indexOf(channel.name);
                    if (idx >= 0) {
                        currentSubscriptions.splice(idx, 1);
                        subBtn.textContent = i18n.t('video.subscribe', '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è');
                        subBtn.classList.remove('subscribed');
                    } else {
                        currentSubscriptions.push(channel.name);
                        subBtn.textContent = i18n.t('video.subscribed', '–ü–æ–¥–ø–∏—Å–∞–Ω');
                        subBtn.classList.add('subscribed');
                    }
                    await saveSubscriptionsToFile(currentSubscriptions);
                    await renderSubscribedChannelsList();
                } catch (_) {}
            });

            info.appendChild(name);
            info.appendChild(stats);
            
            card.appendChild(avatar);
            card.appendChild(info);
            card.appendChild(subBtn);
            
            card.addEventListener('click', () => {
                window.location.href = `youvi_ch_view.html?channel=${encodeURIComponent(channel.name)}`;
            });
            
            return card;
        }

        function renderPagination(totalPages, totalItems) {
            const container = document.getElementById('paginationContainer');
            if (!container) return;

            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            const pagination = document.createElement('div');
            pagination.className = 'pagination';

            const info = document.createElement('div');
            info.className = 'pagination-info';
            info.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${Math.min((currentPage - 1) * channelsPerPage + 1, totalItems)}-${Math.min(currentPage * channelsPerPage, totalItems)} –∏–∑ ${totalItems}`;
            pagination.appendChild(info);

            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'pagination-btn';
                prevBtn.textContent = '‚Äπ –ù–∞–∑–∞–¥';
                prevBtn.addEventListener('click', () => {
                    currentPage--;
                    renderChannels();
                });
                pagination.appendChild(prevBtn);
            }

            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    renderChannels();
                });
                pagination.appendChild(pageBtn);
            }

            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'pagination-btn';
                nextBtn.textContent = '–í–ø–µ—Ä–µ–¥ ‚Ä∫';
                nextBtn.addEventListener('click', () => {
                    currentPage++;
                    renderChannels();
                });
                pagination.appendChild(nextBtn);
            }

            container.innerHTML = '';
            container.appendChild(pagination);
        }

        function escapeHtml(text) {
            const d = document.createElement('div');
            d.textContent = text ?? '';
            return d.innerHTML;
        }

        function updateSectionTitle() {
            const titleElement = document.querySelector('.section-title');
            const countElement = document.getElementById('channelsCount');
            if (!titleElement) return;
            
            titleElement.textContent = i18n.t('channels.title', '–ö–∞–Ω–∞–ª—ã');
            
            if (countElement) {
                const count = filteredChannels.length;
                countElement.textContent = i18n.t('channels.channelsCount', '{count} –∫–∞–Ω–∞–ª–æ–≤').replace('{count}', count);
            }
        }

        (function initLangSwitcher() {
            const langSwitcher = document.getElementById('langSwitcher');
            if (!langSwitcher) return;
            
            langSwitcher.value = i18n.getCurrentLanguage();
            
            langSwitcher.addEventListener('change', async (e) => {
                const newLang = e.target.value;
                await i18n.setLanguage(newLang);
                renderChannels();
                renderSubscribedChannelsList();
            });
            
            i18n.subscribe((lang) => {
                langSwitcher.value = lang;
                renderChannels();
                renderSubscribedChannelsList();
            });
        })();

    </script>
    
    <!-- Autocomplete Module -->
    <link rel="stylesheet" href="youvi/autocomplete/autocomplete.css">
    <script src="youvi/autocomplete-data-loader.js"></script>
    <script src="youvi/autocomplete/autocomplete-cache.js"></script>
    <script src="youvi/autocomplete/autocomplete.js"></script>
    <script src="youvi/autocomplete/autocomplete-integration.js"></script>
    
    <!-- Theme Toggle Script -->
    <script src="youvi/themes/theme-toggle.js"></script>
</body>
</html>